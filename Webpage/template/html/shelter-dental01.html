<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H-CRISIS Assistant 避難所口腔保健アセスメント情報入力</title>
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="../js/mqttws31.js"></script>
    <script src="../js/mqtthcrisis20160905.js"></script>
    <link href="../css/shelterSurvey.css" type="text/css" rel="stylesheet" />
</head>
<body>
<form>
    <fieldset>
        <h3>避難所口腔保健アセスメント情報入力(全て必須項目)</h3>
        <strong><u>※ 入力欄にあらかじめ「0」と表示されている項目は、半角数字で入力して下さい。該当欄は半角数字以外入力できません。</u></strong><br><br>
        <div class="inputbox">
            <label>災害コード</label>
            <input type="text" id="eventCode" value="" style="border: 1px solid #aaaaaa;">
            <br>
            <label>避難所コード</label>
            <input type="text" id="inputCode" value="" style="border: 1px solid #aaaaaa;">
            <br>
            <label>避難所名</label>
            <input type="text" id="inputShelter" value="" style="border: 1px solid #aaaaaa;">
            <br>
            <label>記録者名</label>
            <input type="text" id="inputHuman" value="" style="border: 1px solid #aaaaaa;">
            <br>
            <label>避難者数</label>
            <input type="text" onKeyup="this.value=this.value.replace(/[^0-9]+/,'')" id="inputNum" value="" placeholder="0" style="border: 1px solid #aaaaaa;">
            <br>
            <label class="over" style="padding-top: 0">口腔衛生要配慮者(人、％)</label>
            <input type="text" id="inputDentalPatient" value="" style="border: 1px solid #aaaaaa;">
            <br>
            <br>
        </div>
        <div class="radio">
            <div class="checkbox">
                <label class="lbl">口腔清掃等の環境</label><br><br>
                <input type="radio" name="q0" id="q0_0" value="優">
                <label for="q0_0" class="EX">優</label>
                <input type="radio" name="q0" id="q0_1" value="良">
                <label for="q0_1" class="GD">良</label>
                <input type="radio" name="q0" id="q0_2" value="可">
                <label for="q0_2" class="NT">可</label>
                <input type="radio" name="q0" id="q0_3" value="不可">
                <label for="q0_3" class="TR">不可</label>
                <input type="radio" name="q0" id="q0_4" value="不明" checked>
                <label for="q0_4" class="UK">不明</label>
            </div>
            <br>
            <br>
            <div class="checkbox">
                <label class="lbl">口腔清掃用具等の確保</label><br><br>
                <input type="radio" name="q1" id="q1_0" value="優">
                <label for="q1_0" class="EX">優</label>
                <input type="radio" name="q1" id="q1_1" value="良">
                <label for="q1_1" class="GD">良</label>
                <input type="radio" name="q1" id="q1_2" value="可">
                <label for="q1_2" class="NT">可</label>
                <input type="radio" name="q1" id="q1_3" value="不可">
                <label for="q1_3" class="TR">不可</label>
                <input type="radio" name="q1" id="q1_4" value="不明" checked>
                <label for="q1_4" class="UK">不明</label>
            </div>
            <br>
            <br>
            <div class="checkbox">
                <label class="lbl">口腔清掃状況</label><br><br>
                <input type="radio" name="q2" id="q2_0" value="優">
                <label for="q2_0" class="EX">優</label>
                <input type="radio" name="q2" id="q2_1" value="良">
                <label for="q2_1" class="GD">良</label>
                <input type="radio" name="q2" id="q2_2" value="可">
                <label for="q2_2" class="NT">可</label>
                <input type="radio" name="q2" id="q2_3" value="不可">
                <label for="q2_3" class="TR">不可</label>
                <input type="radio" name="q2" id="q2_4" value="不明" checked>
                <label for="q2_4" class="UK">不明</label>
            </div>
            <br>
            <br>
            <div class="checkbox">
                <label class="lbl">歯や口の訴え・異常</label><br><br>
                <input type="radio" name="q3" id="q3_0" value="優">
                <label for="q3_0" class="EX">優</label>
                <input type="radio" name="q3" id="q3_1" value="良">
                <label for="q3_1" class="GD">良</label>
                <input type="radio" name="q3" id="q3_2" value="可">
                <label for="q3_2" class="NT">可</label>
                <input type="radio" name="q3" id="q3_3" value="不可">
                <label for="q3_3" class="TR">不可</label>
                <input type="radio" name="q3" id="q3_4" value="不明" checked>
                <label for="q3_4" class="UK">不明</label>
            </div>
            <br>
            <br>
            <div class="checkbox">
                <label class="lbl">歯科保健医療の確保</label><br><br>
                <input type="radio" name="q4" id="q4_0" value="優">
                <label for="q4_0" class="EX">優</label>
                <input type="radio" name="q4" id="q4_1" value="良">
                <label for="q4_1" class="GD">良</label>
                <input type="radio" name="q4" id="q4_2" value="可">
                <label for="q4_2" class="NT">可</label>
                <input type="radio" name="q4" id="q4_3" value="不可">
                <label for="q4_3" class="TR">不可</label>
                <input type="radio" name="q4" id="q4_4" value="不明" checked>
                <label for="q4_4" class="UK">不明</label>
            </div>
            <br>
            <br>
            <div class="inputbox">
                <label class="over" style="width: 260px">その他の問題・備考</label><br><br>
                <textarea style="width: 260px; height: 60px" type="text" id="q5_0" value=""></textarea>
            </div>
        </div>
    </fieldset>

    <center>
        <fieldset>
            <script>
                function createMessage() {
                    var topicMsg = "/hcrisis/assistant/event/" + document.getElementById('eventCode').value
                            + "/shelter/" + document.getElementById('inputCode').value + "/dental01";

                    /*
                     var createMsg = document.getElementById('eventCode').value +
                     ',' + document.getElementById('inputCode').value +
                     ',' + document.getElementById('inputShelter').value +
                     ',' + document.getElementById('inputHuman').value +
                     ',' + document.getElementById('inputNum').value;

                     for(var i = 0; i < 9; i++) {
                     var arrayValue = "q" + i;
                     var tmpList = document.getElementsByName(arrayValue);
                     for(var j=0; j<tmpList.length; j++) {
                     if(tmpList[j].checked) {
                     createMsg = createMsg + ',' + tmpList[j].value;
                     continue;
                     }
                     }
                     }
                     */

                    var createMsg = "reporter='" + document.getElementById('inputHuman').value + "'";
                    if(document.getElementById('inputNum').value!=='') {
                        createMsg = createMsg + ",a01=" + document.getElementById('inputNum').value;
                    }
                    if(document.getElementById('inputDentalPatient').value!=='') {
                        createMsg = createMsg + ",dental001=" + document.getElementById('inputDentalPatient').value;
                    }

                    var tmpList = document.getElementsByName('q0'); //q0
                    for(var j=0; j<tmpList.length; j++) {
                        if (tmpList[j].checked) {
                            createMsg = createMsg + ",dental002='" + tmpList[j].value + "'";
                            continue;
                        }
                    }

                    tmpList = document.getElementsByName('q1'); // q1
                    for(var j=0; j<tmpList.length; j++) {
                        if (tmpList[j].checked) {
                            createMsg = createMsg + ",dental003='" + tmpList[j].value + "'";
                            continue;
                        }
                    }

                    tmpList = document.getElementsByName('q2'); // q2
                    for(var j=0; j<tmpList.length; j++) {
                        if (tmpList[j].checked) {
                            createMsg = createMsg + ",dental004='" + tmpList[j].value + "'";
                            continue;
                        }
                    }

                    tmpList = document.getElementsByName('q3'); // q3
                    for(var j=0; j<tmpList.length; j++) {
                        if (tmpList[j].checked) {
                            createMsg = createMsg + ",dental005='" + tmpList[j].value + "'";
                            continue;
                        }
                    }

                    tmpList = document.getElementsByName('q4'); // q4
                    for(var j=0; j<tmpList.length; j++) {
                        if (tmpList[j].checked) {
                            createMsg = createMsg + ",dental006='" + tmpList[j].value + "'";
                            continue;
                        }
                    }

                    createMsg = createMsg + ",dental007='" + document.getElementById('q5_0').value + "'";

                    var nowTime = new Date();
                    var nowYer = nowTime.getFullYear();
                    var nowMon = nowTime.getMonth() + 1;
                    var nowDay = nowTime.getDate();
                    var nowHrs = nowTime.getHours();
                    var nowMin = nowTime.getMinutes();
                    var nowSec = nowTime.getSeconds();
                    createMsg = createMsg + ", timestamp='" + nowYer + "/" + nowMon + "/" + nowDay + " " + nowHrs + ":" + nowMin + ":" + nowSec + "'";
                    console.log(topicMsg + " : " + createMsg);
                    publishMsg(topicMsg, createMsg, true);
                }
            </script>
            <div>
                <input style="border: 0;float: inherit;width: 70px;margin: 0;background: #6d6d6d;color: #ffffff;font-size: 16px;text-align: center;" id ="closeBtn" type="button" onclick="window.close()" value="閉じる" >
                <input style="border: 0;float: inherit;width: 70px;margin: 0;background: #228b22;color: #ffffff;font-size: 16px;text-align: center;" id = "submitBtn" type="button" onclick="createMessage();" value="送信" >
            </div>
            <script>
                var urlStr = location.search.substring(1);
                if(urlStr === '') {
                    // 避難所IDと避難所名がないと送信ボタンが押せない設定
                    document.getElementById('submitBtn').disabled = 'true';
                }
                else {
                    var pairUrlStr = urlStr.split(',');
                    if(pairUrlStr.length>=2) {
                        console.log(pairUrlStr[0])
                        pairUrlStr[0] = decodeURI(pairUrlStr[0].substr(6)); // event=から始まる
                        pairUrlStr[1] = decodeURI(pairUrlStr[1].substr(3)); // id=から始まる
                        pairUrlStr[2] = decodeURI(pairUrlStr[2].substr(5)); // name=から始まる
                        document.getElementById('eventCode').value = pairUrlStr[0];
                        document.getElementById('eventCode').disabled = 'true';
                        document.getElementById('inputCode').value = pairUrlStr[1];
                        document.getElementById('inputCode').disabled = 'true';
                        document.getElementById('inputShelter').value = pairUrlStr[2];
                        document.getElementById('inputShelter').disabled = 'true';
                    }
                }
            </script>

        </fieldset>
    </center>
</form>
</body>
</html>