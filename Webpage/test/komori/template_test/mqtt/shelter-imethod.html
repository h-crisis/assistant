<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H-CRISIS Assistant 避難所アセスメントシート (Tadashi Ishii all rights reserved)</title>
    <script src="mqttws31.js"></script>
    <script src="mqtthcrisis.js"></script>
</head>
<body>
<form>
    <p>避難所アセスメントシート<label style="float:right">記入救護班名:<input type="text" id="inputHuman"  value=""></label></p>
    <p>※ 右上の記入救護班名は入力必須です。</p>
    <fieldset>
        <legend>避難所情報の入力：避難所の概要</legend>
        ※ 情報が取得できなかった場合、該当箇所は空欄のままで送信してください。
        <br>
        <label>避難所コード:<input type="text" id="inputCode"  value=""></label><br>
        <label>避難所名:<input type="text" id="inputSchelter"  value=""></label><br>
        <hr>
        <form width="100">アラート情報：
            <label><input type="radio" name="q11" value="有" onclick="inputAlert()">有</label>
            <label><input type="radio" name="q11" value="無" onclick="inputAlert()" checked="checked">無</label>
        </form><br>
        <input style="display:none" type="text" id="inputAlertInfo"  value="">
        <hr>
    </fieldset>
    <fieldset>
        <legend>避難所情報の入力：組織</legend>
        ※ 情報が取得できなかった場合、該当箇所は空欄のままで送信してください。
        <br>
        <form>
        <label>地区名:<input type="text" id="inputDist"  value=""></label>
        </form>
        <hr>
        <form>避難所電話：
            <label><input type="radio" name="q21" value="開通" onclick="inputTELNumber()">開通</label>
            <label><input type="radio" name="q21" value="不通" onclick="inputTELNumber()" checked="checked">不通</label>
        </form>
        <input style="display:none" type="text" id="inputTELNumber"  value="">
        <hr>
        <form>
        <label>リーダー氏名:<input type="text" id="inputLeaderName"  value=""></label>
        <label>リーダー電話番号:<input type="text" id="inputLeaderTEL"  value=""></label>
        <label>リーダーメールアドレス:<input type="text" id="inputLeaderMail"  value=""></label><br>
        既医療支援：
            <label><input type="checkbox" name="C1" value="DMAT">DMAT</label>
            <label><input type="checkbox" name="C1" value="JMAT">JMAT</label>
            <label><input type="checkbox" name="C1" value="日赤">日赤</label>
            <label><input type="checkbox" name="C1" value="大学">大学</label>
            <label><input type="checkbox" name="C1" value="国病">国病</label>
            <label><input type="checkbox" name="C1" value="AMAT">AMAT</label>
            <label><input type="checkbox" name="C1" value="都道府県">都道府県</label>
            <label><input type="checkbox" name="C1" value="リハ団体">リハ団体</label>
            <label><input type="checkbox" name="C1" value="その他">その他</label>
            <label><input type="checkbox" name="C1" value="なし">なし</label>
        </form>
    </fieldset>
    <fieldset>
        <legend>避難所情報の入力：人数</legend>
        ※ 情報が取得できなかった場合、該当箇所は空欄のままで送信してください。
        <br>
        <form>
        <label>収容人数:<input type="text" id="inputSchelterCap"  value=""></label>
        <label>一人当たり占有面積:<input type="text" id="inputPerWide"  value="">m2くらい</label><br>
        </form>
        <hr>
        <form>
        <label>有症状者総数:<input type="text" id="inputTotalPatient"  value="">人</label><br>
        <label>症状内訳: <br>
            発熱(≧38℃)<input type="text" id="inputP_Feaver"  value="">人</label>
        <label>頭痛<input type="text" id="inputP_Head"  value="">人</label>
        &nbsp;&nbsp;
        <label>せき<input type="text" id="inputP_Cough"  value="">人</label>
        <label>外傷<input type="text" id="inputP_Injury"  value="">人</label><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <label>嘔吐<input type="text" id="inputP_Nausea"  value="">人</label>
        <label>下痢<input type="text" id="inputP_Diarrhea"  value="">人</label>
        <label>その他<input type="text" id="inputP_TRest"  value="">人</label>
        </form>
        <hr>
        <form>
        <label>要援護:<input type="text" id="inputTotalSupport"  value="">人 内訳：</label><br>
        <label>全介助<input type="text" id="inputS_Total"  value="">人</label>
        <label>一部介助<input type="text" id="inputS_Partial"  value="">人</label>
        <label>認知障害<input type="text" id="inputS_Cognitive"  value="">人</label>
        <label>乳幼児<input type="text" id="inputS_Infant"  value="">人</label>
        <br>
        <label>外国人<input type="text" id="inputS_Visitor"  value="">人</label>
        <label>その他<input type="text" id="inputS_TRest"  value="">人 具体的症状</label>
        <label><input type="text" style="width: 350px" id="inputS_TRestD" value=""></label>
        </form>
        <hr>
        <form>
        <label>要医療:<input type="text" id="inputTotalCare"  value="">人 内訳：</label><br>
        <label>要酸素(呼吸困難含む)<input type="text" id="inputC_Oxy"  value="">人</label>
        <label>慢性透析<input type="text" id="inputC_Dialysis"  value="">人</label>
        <label>インフルエンザ<input type="text" id="inputC_Flu"  value="">人</label>
        <br>
        <label>その他<input type="text" id="inputC_TRest"  value="">人 具体的症状</label>
        <label><input type="text" style="width: 500px" id="inputC_TRestD"  value=""></label>
        </form>
    </fieldset>
    <fieldset>
        <legend>避難所情報の入力：専門的医療ニーズ</legend>
        ※ 情報が取得できなかった場合、該当箇所は空欄のままで送信してください。
        <br>
        <form>小児疾患：
            <label><input type="radio" name="q31" value="有(緊急)">有(緊急)</label>
            <label><input type="radio" name="q31" value="有(≠緊急)">有(≠緊急)</label>
            <label><input type="radio" name="q31" value="無" checked="checked">無</label>
            <label>1歳未満<input type="text" id="inputN_Infant"  value="">人</label>
            <br>
        <label>具体的症状<input type="text" style="width: 500px" id="inputN_IDetail"  value=""></label>
        </form>
        <hr>
        <form>精神疾患：
            <label><input type="radio" name="q32" value="有(緊急)">有(緊急)</label>
            <label><input type="radio" name="q32" value="有(≠緊急)">有(≠緊急)</label>
            <label><input type="radio" name="q32" value="無" checked="checked">無</label>
        <label>不眠・不安<input type="text" id="inputN_Insomnia"  value="">人</label>
        <label>精神科疾患<input type="text" id="inputN_Psy"  value="">人</label><br>
        <label>具体的症状<input type="text" style="width: 500px" id="inputN_PDetail"  value=""></label>
        </form>
        <hr>
        <form>周産期：
            <label><input type="radio" name="q33" value="有(緊急)">有(緊急)</label>
            <label><input type="radio" name="q33" value="有(≠緊急)">有(≠緊急)</label>
            <label><input type="radio" name="q33" value="無" checked="checked">無</label>
            <label>妊婦<input type="text" id="inputN_Pregnants"  value="">人</label>
            <label>産褥期<input type="text" id="inputN_Puerperium"  value="">人</label><br>
            <label>具体的症状<input type="text" style="width: 500px" id="inputN_BDetail"  value=""></label>
        </form>
        <hr>
        <form>歯科：
            <label><input type="radio" name="q34" value="有(緊急)">有(緊急)</label>
            <label><input type="radio" name="q34" value="有(≠緊急)">有(≠緊急)</label>
            <label><input type="radio" name="q34" value="無" checked="checked">無</label>
            <label>歯痛<input type="text" id="inputN_Tooth"  value="">人</label>
            <label>入れ歯紛失／消失<input type="text" id="inputN_FalseTooth"  value="">人</label><br>
            <label>具体的症状<input type="text" style="width: 500px" id="inputN_TDetail"  value=""></label>
        </form>
    </fieldset>
    <fieldset>
        <legend>避難所情報の入力：ライフライン・公衆衛生環境</legend>
        ※ 情報が取得できなかった場合、該当箇所は空欄のままで送信してください。<br>
        <hr>
        <form>飲料水: ←十分
            <label><input type="radio" name="q41" value="十分">1</label>
            <label><input type="radio" name="q41" value="やや十分">2</label>
            <label><input type="radio" name="q41" value="やや皆無">3</label>
            <label><input type="radio" name="q41" value="皆無" checked="checked">4 皆無→</label>
            <br>
            水の種類：
            <label><input type="checkbox" name="C2" value="水道">水道</label>
            <label><input type="checkbox" name="C2" value="給水車">給水車</label>
            <label><input type="checkbox" name="C2" value="井戸">井戸</label>
            <label><input type="checkbox" name="C2" value="ペットボトル">ペットボトル</label>
        </form>
        <hr>
        <form>食事: ←十分
            <label><input type="radio" name="q43" value="十分">1</label>
            <label><input type="radio" name="q43" value="やや十分">2</label>
            <label><input type="radio" name="q43" value="やや皆無">3</label>
            <label><input type="radio" name="q43" value="皆無" checked="checked">4 皆無→</label>
        </form>
        <form>電気: ←十分
            <label><input type="radio" name="q44" value="十分">1</label>
            <label><input type="radio" name="q44" value="やや十分">2</label>
            <label><input type="radio" name="q44" value="やや皆無">3</label>
            <label><input type="radio" name="q44" value="皆無" checked="checked">4 皆無→</label>
        </form>
        <form>毛布等の寝具: ←十分
            <label><input type="radio" name="q45" value="十分">1</label>
            <label><input type="radio" name="q45" value="やや十分">2</label>
            <label><input type="radio" name="q45" value="やや皆無">3</label>
            <label><input type="radio" name="q45" value="皆無" checked="checked">4 皆無→</label>
        </form>
        <form>冷暖房: ←十分
            <label><input type="radio" name="q46" value="十分">1</label>
            <label><input type="radio" name="q46" value="やや十分">2</label>
            <label><input type="radio" name="q46" value="やや皆無">3</label>
            <label><input type="radio" name="q46" value="皆無" checked="checked">4 皆無→</label>
        </form>
        <hr>
        <form>衛生環境: ←十分
            <label><input type="radio" name="q47" value="十分">1</label>
            <label><input type="radio" name="q47" value="やや十分">2</label>
            <label><input type="radio" name="q47" value="やや皆無">3</label>
            <label><input type="radio" name="q47" value="皆無" checked="checked">4 皆無→</label>
            <br>
            生活用水(手洗い等)： ←十分
            <label><input type="radio" name="q48" value="十分">1</label>
            <label><input type="radio" name="q48" value="やや十分">2</label>
            <label><input type="radio" name="q48" value="やや皆無">3</label>
            <label><input type="radio" name="q48" value="皆無" checked="checked">4 皆無→</label>
            <br>
            下水：
            <label><input type="radio" name="q49" value="有">有</label>
            <label><input type="radio" name="q49" value="無" checked="checked">無</label>
            <br>
            土足：
            <label><input type="radio" name="q410" value="可">可</label>
            <label><input type="radio" name="q410" value="禁" checked="checked">禁</label>
        </form>
        <hr>
        <form>トイレ: ←十分
            <label><input type="radio" name="q411" value="十分">1</label>
            <label><input type="radio" name="q411" value="やや十分">2</label>
            <label><input type="radio" name="q411" value="やや皆無">3</label>
            <label><input type="radio" name="q411" value="皆無" checked="checked">4 皆無→</label>
            <br>
            汲み取り：←十分または不要
            <label><input type="radio" name="q412" value="十分">1</label>
            <label><input type="radio" name="q412" value="やや十分">2</label>
            <label><input type="radio" name="q412" value="やや皆無">3</label>
            <label><input type="radio" name="q412" value="皆無" checked="checked">4 皆無→</label>
        </form>
    </fieldset>
    <fieldset>
        <legend>その他</legend>
        <label><textarea type="text" style="width: 500px" rows="5" id="inputOTHER"  value=""></textarea></label>
    </fieldset>

    <fieldset>
        <script>
            function createMessage() {
                //var createMsg = "test";

                var topicMsg = "/h-crisis/shelter/ishiiMethod/" + document.getElementById('inputCode').value;
                var createMsg = document.getElementById('inputCode').value +
                        ',' + document.getElementById('inputHuman').value;
                for(var i = 1; i < 5; i++) {
                    for(var j = 1; j < 13; j++) {
                        var arrayValue = "q" + i + j;
                        var tmpList = document.getElementsByName(arrayValue);
                        for (var k = 0; k < tmpList.length; k++) {
                            if (tmpList[k].checked) {
                                createMsg = createMsg + ',' + tmpList[k].value;
                                continue;
                            }
                        }
                    }
                }
                for (var i = 1; i < 3; i++) {
                    var arrayValue = "C" + i;
                    var tmpList = document.getElementsByName(arrayValue);
                    createMsg = createMsg + ','
                    for (var j = 0; j < tmpList.length; j++) {
                        if (tmpList[j].checked) {
                            createMsg = createMsg + '/' + tmpList[j].value;
                            continue;
                        }
                    }
                }

                createMsg = createMsg +
                        ',' + document.getElementById('inputSchelter').value +
                        ',' + document.getElementById('inputAlertInfo').value +
                        ',' + document.getElementById('inputDist').value +
                        ',' + document.getElementById('inputTELNumber').value +
                        ',' + document.getElementById('inputLeaderName').value +
                        ',' + document.getElementById('inputLeaderTEL').value +
                        ',' + document.getElementById('inputLeaderMail').value +
                        ',' + document.getElementById('inputSchelterCap').value +
                        ',' + document.getElementById('inputPerWide').value +
                        ',' + document.getElementById('inputTotalPatient').value +
                        ',' + document.getElementById('inputP_Feaver').value +
                        ',' + document.getElementById('inputP_Head').value +
                        ',' + document.getElementById('inputP_Cough').value +
                        ',' + document.getElementById('inputP_Injury').value +
                        ',' + document.getElementById('inputP_Nausea').value +
                        ',' + document.getElementById('inputP_Diarrhea').value +
                        ',' + document.getElementById('inputP_TRest').value +
                        ',' + document.getElementById('inputTotalSupport').value +
                        ',' + document.getElementById('inputS_Total').value +
                        ',' + document.getElementById('inputS_Partial').value +
                        ',' + document.getElementById('inputS_Cognitive').value +
                        ',' + document.getElementById('inputS_Infant').value +
                        ',' + document.getElementById('inputS_Visitor').value +
                        ',' + document.getElementById('inputS_TRest').value +
                        ',' + document.getElementById('inputS_TRestD').value +
                        ',' + document.getElementById('inputTotalCare').value +
                        ',' + document.getElementById('inputC_Oxy').value +
                        ',' + document.getElementById('inputC_Dialysis').value +
                        ',' + document.getElementById('inputC_Flu').value +
                        ',' + document.getElementById('inputC_TRest').value +
                        ',' + document.getElementById('inputC_TRestD').value +
                        ',' + document.getElementById('inputN_Infant').value +
                        ',' + document.getElementById('inputN_IDetail').value +
                        ',' + document.getElementById('inputN_Insomnia').value +
                        ',' + document.getElementById('inputN_Psy').value +
                        ',' + document.getElementById('inputN_PDetail').value +
                        ',' + document.getElementById('inputN_Pregnants').value +
                        ',' + document.getElementById('inputN_Puerperium').value +
                        ',' + document.getElementById('inputN_BDetail').value +
                        ',' + document.getElementById('inputN_Tooth').value +
                        ',' + document.getElementById('inputN_FalseTooth').value +
                        ',' + document.getElementById('inputN_TDetail').value +
                        ',' + document.getElementById('inputOTHER').value +
                        "," + lat + "," + lon;

                var nowTime = new Date();
                var nowYer = nowTime.getFullYear();
                var nowMon = nowTime.getMonth() + 1;
                var nowDay = nowTime.getDate();
                var nowHrs = nowTime.getHours();
                var nowMin = nowTime.getMinutes();
                createMsg = createMsg + ',' + nowYer + "/" + nowMon + "/" + nowDay + "/" + nowHrs + ":" + nowMin + "";
                console.log(topicMsg + " : " + createMsg);
                onlySubmit(topicMsg, createMsg);
            }
        </script>
        <input id ="closeBtn" type="button" onclick="window.close()" value="閉じる" />
        <input id = "submitBtn" type="button" onclick="createMessage();" value="送信" />
        <script>
            function inputAlert(){
                if (document.getElementsByName('q11')[0].checked) {
                    document.getElementById('inputAlertInfo').style.display = 'block';
                } else {
                    document.getElementById('inputAlertInfo').style.display = 'none';
                }
            }

            function inputTELNumber(){
                if (document.getElementsByName('q21')[0].checked) {
                    document.getElementById('inputTELNumber').style.display = 'block';
                } else {
                    document.getElementById('inputTELNumber').style.display = 'none';
                }
            }

            var urlStr = location.search;
            if(urlStr === '') {
                // 避難所IDと避難所名がないと送信ボタンが押せない設定
                // document.getElementById('submitBtn').disabled = 'true';
            }
            else {
                var pairUrlStr = urlStr.split(',');
                if(pairUrlStr.length>=2) {
                    pairUrlStr[0] = pairUrlStr[0].substr(4);
                    pairUrlStr[0] = decodeURI(pairUrlStr[0]);
                    pairUrlStr[1] = pairUrlStr[1].substr(5);
                    pairUrlStr[1] = decodeURI(pairUrlStr[1]);
                    document.getElementById('inputCode').value = pairUrlStr[0];
                    document.getElementById('inputCode').disabled = 'true';
                    document.getElementById('inputSchelter').value = pairUrlStr[1];
                    document.getElementById('inputSchelter').disabled = 'true';

                }
            }
        </script>

    </fieldset>
</form>
</body>
</html>